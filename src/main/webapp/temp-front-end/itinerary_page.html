<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>TripLight | TripForm</title>
    <script>
        addEventListener(
            "load",
            function () {
                setTimeout(hideURLbar, 0);
            },
            false
        );

        function hideURLbar() {
            window.scrollTo(0, 1);
        }
    </script>

    <!-- lib -->
    <!-- boostrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" rel="stylesheet" />

    <!-- MDB -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/6.3.0/mdb.min.css" rel="stylesheet" />

    <!-- itinerary.css -->
    <link rel="stylesheet" type="text/css" href="css/itinerary.css">

    <!-- soft table -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.css" />

    <!-- jay's -->
    <!-- css files -->
    <link href="css/bootstrap.css" rel="stylesheet" type="text/css" />
    <!-- bootstrap css -->
    <link href="css/style.css" rel="stylesheet" type="text/css" />
    <!-- custom css -->
    <link href="css/fontawesome-all.css" rel="stylesheet" />
    <!-- fontawesome css -->
    <!-- //css files -->

    <!-- google fonts -->
    <!-- 載入字體 -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC&display=swap" rel="stylesheet" />
    <!-- //google fonts -->

    <!-- 載入icon -->
    <link rel="shortcut icon" href="./images/icon.png" />
    <link rel="bookmark" href="./images/icon.png" />

    <!-- yen -->
    <!--jQuery-->
    <!--會員登入-->
    <link href="css/login.css" rel="stylesheet" />
</head>

<body>

    <!-- ========== header ========== -->
    <header>
        <div class="container" style="padding-right: 0px">
            <!-- nav -->
            <nav class="py-md-4 py-3">
                <div id="logo">
                    <h1 class="mt-md-0 mt-2">
                        <a href="index.html"><img src="./images/icon.png" class="icon_triplight" />
                            TripLight
                        </a>
                    </h1>
                </div>
                <label for="drop" class="toggle"><span class="fa fa-bars"></span></label>
                <input type="checkbox" id="drop" />
                <ul class="menu ml-auto mt-1">
                    <li class=""><a href="index.html">首頁</a></li>
                    <li class=""><a href="booking.html">AI行程規劃</a></li>
                    <li class="active"><a href="tickets.html">票券</a></li>
                    <li class=""><a href="itinerary_search.html?index=1">套裝行程</a></li>
                    <li class=""><a href="articles.html">旅遊文章</a></li>
                    <li class="booking"><a href="" id="login">登入/註冊</a></li>
                    <li class="">
                        <a href="shopping_car.html"><img src="./images/shoppingCar.svg" alt="" style="width: 2em" /></a>
                    </li>
                </ul>
            </nav>
            <!-- //nav -->
            <div class="member">
                <ul class="member_list">
                    <li class="member_li"><a href="login.html"><i class="fa-regular fa-user"></i>管理帳戶</a>
                    </li>
                    <li class="member_li" id="order_li"><a href=""><i class="fa-solid fa-plane"></i>訂單管理</a>
                        <ul class="order_list">
                            <li class="order_content"><a href="tickets_order.html"><i
                                        class="fa-solid fa-ticket"></i>票券訂單</a></li>
                            <li class="order_content"><a href="group_order.html"><i
                                        class="fa-solid fa-suitcase"></i>旅遊團訂單</a>
                            </li>
                        </ul>
                    </li>
                    <li class="member_li"><a href="my_favorite.html"><i class="fa-regular fa-heart"></i>我的收藏</a></li>
                    <li class="member_li"><a href="article_mylist.html"><i class="fa-solid fa-copy"></i>我的文章</a>
                    </li>
                    <li class="member_li"><a href="membership_rating.html"><i class="fa-regular fa-gem"></i>會員分級</a>
                    </li>
                    <li class="member_li"><a href="question_form.html"><i class="fa-regular fa-comment"></i>提出問題</a>
                    </li>
                    <li class="member_li"><a href="read_question_list.html"><i
                                class="fa-regular fa-comment"></i>查看問題</a>
                    </li>
                    <li class="member_li" id="logout_li"><a href="index.html"><i
                                class="fa-solid fa-right-from-bracket"></i>登出</a></li>
                </ul>
            </div>
        </div>
    </header>
    <!-- ========== //header ========== -->

    <!-- ========== 登入 ========== -->
    <div id="login-container">
        <!---container--->

        <div class="main-box login">
            <h3>登入</h3>
            <form action="">
                <div class="input-box">
                    <i class="fas fa-envelope icon2"></i> <input type="email" name="email" id="email" required /> <label
                        for="">信箱</label>
                </div>
                <div class="input-box">
                    <i class="fas fa-lock icon2"></i> <input type="password" name="password" id="password" required />
                    <label for="">密碼</label>
                </div>
                <div class="check">
                    <label><input type="checkbox" />記住我</label> <a href="#" id="forgetPwd">忘記密碼</a>
                </div>
                <button type="submit" class="main-btn">Login</button>
                <div class="register">
                    <p>
                        如果沒有帳號?<a href="#" class="register-link">點擊註冊</a>
                    </p>
                </div>
            </form>
        </div>

        <div class="main-box register">
            <h3>註冊</h3>
            <form action="">
                <div class="input-box">
                    <i class="fas fa-user icon2"></i> <input type="email" name="account" id="register_account"
                        required /> <label for="">使用者名稱</label>
                </div>
                <div class="input-box">
                    <i class="fas fa-envelope icon2"></i> <input type="email" name="email" id="register_email"
                        required /> <label for="">信箱</label>
                </div>
                <div class="input-box">
                    <i class="fas fa-lock icon2"></i> <input type="password" name="password" id="register_password"
                        required />
                    <label for="">密碼</label>
                    <h6 id="pwdHint">密碼設定請超過八碼</h6>
                </div>
                <div class="check">
                    <label><input type="checkbox" />我同意所有條款</label>
                </div>
                <button type="submit" class="main-btn">註冊</button>
                <div class="register">
                    <p>
                        已經有帳號?<a href="#" class="login-link">點擊登入</a>
                    </p>
                </div>
            </form>
        </div>

        <span class="close-icon">
            <div class="fas fa-times"></div>
        </span>
    </div>
    <!-- ========== //登入 ========== -->

    <!-- ========== banner ========== -->
    <section class="banner_inner" id="home">
        <div class="banner_inner_overlay"></div>
    </section>
    <!-- ========== //banner ========== -->



    <!-- ========== top Carousel pics ========== -->
    <div class="container mt-lg-3 shadow-none">
        <div id="carouselExampleIndicators" class="carousel slide" data-bs-ride="carousel">
            <div class="carousel-indicators">
                <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="0" class="active"
                    aria-current="true" aria-label="Slide 1"></button>
                <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="1"
                    aria-label="Slide 2"></button>
                <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="2"
                    aria-label="Slide 3"></button>
            </div>
            <div class="carousel-inner" id="tripPics">
                <!--                <div class="carousel-item active">-->
                <!--                    <img style="weight:80%;  height: 500px;" src="https://picsum.photos/800/600/?random=43" class="d-block w-100" alt="...">-->
                <!--                </div>-->
                <!--                <div class="carousel-item">-->
                <!--                    <img style="weight:80%;  height: 500px;" src="https://picsum.photos/800/600/?random=43" class="d-block w-100" alt="...">-->
                <!--                </div>-->
                <!--                <div class="carousel-item">-->
                <!--                    <img style="weight:80%;  height: 500px;" src="https://picsum.photos/800/600/?random=43" class="d-block w-100" alt="...">-->
                <!--                </div>-->
            </div>
            <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleIndicators"
                data-bs-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Previous</span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleIndicators"
                data-bs-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Next</span>
            </button>
        </div>
    </div>

    <!-- ========== top Carousel pics ========== -->

    <!-- ========== outer ========== -->
    <div class="container shadow-none p-3 mb-5 bg-light rounded">

        <!--======================================================Layer 2 content======================================================-->
        <div class="row shadow p-3 mb-5 bg-body rounded">
            <!--======================================================Layer 2 left content======================================================-->
            <div class="col-8">
                <div class="row">
                    <div style="padding: 20px 20px 20px 20px;" class="col-md-12">
                        <h2 id="tripName"></h2>
                        <hr class="hr" />
                        <i class="fa-sharp fa-solid fa-location-dot" style="color: #46dadd;"></i>
                        <span id="city"></span>
                        <hr class="hr" />
                        <div>
                            <pre id="tripContent">
                            </pre>
                        </div>
                    </div>
                </div>

            </div>
            <!--======================================================Layer 2 right ======================================================-->

            <div class="col-4 p-5">
                <div class="row m-5 justify-content-around my-favorite ">
                    <i class="fa-solid fa-heart fa-lg" id="heart"></i>
                </div>
                <div class="row m-5">
                    <h3 id="beginPrice"></h3>
                </div>
                <div class="row m-5">
                    <button type="button" class="btn btn-info" id="scrollBtn">選擇方案</button>
                </div>
            </div>

        </div>


        <div class="card mb-3" id="targetSection">
            <div class="row g-0">
                <div class="col-7">

                    <h3 class="m-5">選擇日期、選項</h3>
                    <div id="calendar" class="m-5"></div>
                </div>
                <div class="col-4 m-5">
                    <div class="row h-25 d-inline-block">
                    </div>

                    <!-- 選擇的日期 -->
                    <div class="row justify-content-center">
                        <div class="col-5 ">
                            <h5 class="text-secondary"> 選擇日期: </h5>

                        </div>

                        <div class="col-6" id="selectedDate">
                        </div>
                    </div>
                    <!-- 選項人數列 -->
                    <div class="row justify-content-center">
                        <div class="col-5 ">
                            <h5 class="text-secondary"> 目前確認人數: </h5>

                        </div>

                        <div class="col-6">
                            <h5 class="text-secondary" id="confirmedTravelersNo"></h5>
                        </div>
                    </div>
                    <!-- 選項人數列 -->
                    <!-- 選項人數列 -->
                    <div class="row justify-content-center">
                        <div class="col-5">
                            <h5 class="text-secondary"> 最少成團人數: </h5>
                        </div>
                        <div class="col-6">
                            <h5 class="text-secondary" id="minTravelersNo"></h5>
                        </div>
                    </div>
                    <div class="row justify-content-center">
                        <div class="col-5">
                            <h5 class="text-secondary"> 旅遊團人數上限: </h5>
                        </div>
                        <div class="col-6">
                            <h5 class="text-secondary" id="maxTravelersNo"></h5>
                        </div>
                    </div>

                    <div class="row justify-content-center">
                        <div class="col-5">
                            <h5 class="text-secondary"> 剩餘名額: </h5>
                        </div>
                        <div class="col-6">
                            <h5 class="text-secondary" id="leftTravelersNo"></h5>
                        </div>
                    </div>
                    <!-- 選項人數列 -->
                    <!-- 選項人數列 -->
                    <div class="row d-inline-block">
                        <hr class="hr" />
                    </div>
                    <!-- 選項人數列 -->
                    <!-- 選項兒童列 -->
                    <div class="row mt-2">
                        <div class="col-2">
                            <h5> 兒童 </h5>
                        </div>
                        <div class="col-4">
                            <span id="priceChild" value="100"> 100 元/每人 </span>
                        </div>
                        <div class="col-5">
                            <div class="input-group input-group">

                                <button class="btn btn-outline-secondary" type="button" id="minus_child">-</button>
                                <input type="text" class="form-control" id="count_child" value="0">
                                <button class="btn btn-outline-secondary plus" type="button" id="plus_child">+</button>

                            </div>
                        </div>
                    </div>
                    <!-- 選項兒童列 -->

                    <!-- 選項大人列 -->
                    <div class="row mt-2">

                        <div class="col-2">
                            <h5> 大人 </h5>
                        </div>
                        <div class="col-4">
                            <span id="priceAdult"></span>
                        </div>
                        <div class="col-5">
                            <div class="input-group input-group">

                                <button class="btn btn-outline-secondary" type="button" id="minus_adult">-</button>
                                <input type="text" class="form-control" id="count_adult" value="0">
                                <button class="btn btn-outline-secondary plus" type="button" id="plus_adult">+</button>

                            </div>
                        </div>
                    </div>
                    <!-- 選項大人列 -->



                    <!-- 選項價格列 -->
                    <div class="row mt-3">
                        <div class="col-3">
                            <h5> 總金額 </h5>
                        </div>
                        <div class="col-9">
                            <h5 id="amount" value="100"> </h5>
                        </div>
                    </div>
                    <!-- 選項價格列 -->

                    <div class="row"></div>
                    <div class="row">
                        <button type="button" class="btn btn-primary btn-lg" id="orderBtn">我要預定</button>
                    </div>

                </div>

            </div>
        </div>
    </div>


    <!--======================================================Layer 3 內容區 =============================================-->

    <div class="container shadow p-3 mb-5 rounded">
        <div class="row justify-content-center">
            <div class="col-md-8 bi-text-right">
                <!-- ====== Scrollspy content ====== -->
                <div data-mdb-spy="scroll" data-mdb-target="#scrollspy-collapsible" data-mdb-offset="0"
                    class="scrollspy-example scrollspy-example-collapsible">
                    <section id="example-1-collapsible">
                        <h3>行程介紹</h3>
                        <hr class="hr" />
                        <div style="font-size: 20px; overflow-wrap: break-word; word-wrap: break-word; ">
                            <pre id="tripDescription">

                            </pre>
                        </div>
                    </section>
                    <section id="example-2-collapsible">
                        <h3 class="mt-5">注意事項</h3>
                        <hr class="hr" />
                        <div style="font-size: 20px; overflow-wrap: break-word; word-wrap: break-word; ">
                            <pre id="tripNote">

                            </pre>
                        </div>
                    </section>

                </div>
                <!-- Spied element -->
            </div>

            <!-- ====== Scrollspy items ====== -->
            <div class="col-md-4">
                <!-- Scrollspy -->
                <div id="scrollspy-collapsible" class="sticky-top">
                    <ul class="nav flex-column nav-pills menu-sidebar">
                        <li class="nav-item">
                            <a style="font-size: 28px; margin: 15px;" class="nav-link"
                                href="#example-1-collapsible">行程介紹</a>
                        </li>
                        <li class="nav-item">
                            <a style="font-size: 28px; margin: 15px;" class="nav-link"
                                href="#example-2-collapsible">注意事項</a>
                        </li>
                    </ul>
                </div>
                <!-- Scrollspy -->

            </div>


        </div>
        <!-- ========== comments ========== -->

        <div class="container mt-5">
            <div class="row justify-content-center">


                <div class="col-8 shadow p-3 mb-5 bg-body rounded">
                    <!-- 旅客評價第一區 -->
                    <div class="row">
                        <h3 id="commemt_title" class="p-3">旅客評價</h3>
                        <hr class="hr" />
                    </div>
                    <!-- 旅客評價 -->


                    <!-- 旅客評價第二區 -->
                    <div class="row">

                        <!-- 此欄空白 -->
                        <!-- 排序按鈕 -->
                        <!-- 旅客評價第二區 -->
                        <!-- 評論本體 -->
                        <div class="h3 mt-3"></div>
                        <ul class="list-group" id="commentParent">
                        </ul>

                    </div>
                </div>

                <!-- 旅客評價標頭右邊空白 -->
                <div class="col-4">
                    <pre>


                </pre>
                </div>
            </div>
            <!-- 旅客評價標頭右邊空白 -->


        </div>
        <!-- 評論本體 -->


    </div>

    <!-- ========== //outer ========== -->

    <!-- ========== footer ========== -->
    <footer>
        <section class="footer footer_w3layouts_section_1its py-5">
            <div class="container py-lg-4 py-3">
                <div class="row footer-top">
                    <div class="col-lg-3 col-sm-6 footer-grid_section_1its_w3">
                        <div class="footer-title">
                            <h3>地點資訊</h3>
                        </div>
                        <div class="row">
                            <ul class="col-12 links">
                                <li>
                                    <a href="https://www.google.com/maps?q=桃園市中壢區復興路46號9樓"
                                        target="_blank">地址：桃園市中壢區復興路46號9樓</a>
                                </li>
                                <li><a href="tel:02-1234-5678">電話：02-1234-5678</a></li>
                                <li>
                                    <a href="mailto:contact@example.com">信箱：triplirht@gmail.com</a>
                                </li>
                                <li><a href="tel:02-1234-5678">傳真：02-1234-5678</a></li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-lg-3 col-sm-6 footer-grid_section mt-sm-0 mt-4">
                        <div class="footer-title">
                            <h3>認識TripLight</h3>
                        </div>
                        <div class="row">
                            <ul class="col-10 links">
                                <li><a href="about.html" class="scroll">關於我們</a></li>
                                <li>
                                    <a href="user_terms.html" class="scroll">使用者條款 </a>
                                </li>
                                <li>
                                    <a href="privacy_policy.html" class="scroll">隱私權保護政策</a>
                                </li>
                                <li><a href="faq.html" class="scroll"> 常見問題與幫助</a></li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-lg-3 col-sm-6 mt-lg-0 mt-4 footer-grid_section_1its_w3">
                        <div class="footer-title">
                            <h3>成為合作夥伴</h3>
                        </div>
                        <div class="row">
                            <ul class="col-6 links">
                                <li>
                                    <a href="supplier_form.html" class="scroll">成為供應商</a>
                                </li>
                                <li>
                                    <a href="blogger_photographer.html" class="scroll">部落客/攝影師合作計畫</a>
                                </li>
                                <li>
                                    <a href="group_form.html" class="scroll">團體客製規劃</a>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-lg-3 col-sm-6 mt-lg-0 mt-4 footer-grid_section_1its_w3">
                        <div class="footer-title">
                            <h3>聯絡我們</h3>
                        </div>
                        <ul class="social_section_1info">
                            <li>
                                <a href="https://www.facebook.com/TibaMe"><img src="./images/facebook.svg"
                                        alt="facebook" /></a>
                            </li>
                            <li>
                                <a href="https://www.instagram.com/tibame_wiedu/"><img src="./images/instagram.svg"
                                        alt="instagram" /></a>
                            </li>
                            <li>
                                <a href="https://twitter.com/"><img src="./images/twitter.svg" alt="twitter" /></a>
                            </li>
                            <li class="youtube">
                                <a href="https://www.youtube.com/channel/UClhecf7eOGHwbKW5e7l_pTA"><img
                                        src="./images/youtube.svg" alt="youtube" /></a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>
    </footer>
    <!-- ========== //footer ========== -->

    <!--  ========== copyright  ========== -->
    <div class="copyright py-3 text-center">
        <p>COPYRIGHT © 2023 TripLight All rights reserved.</p>
    </div>
    <!-- ==========  //copyright ========== -->

    <!-- ==========  move top ========== -->
    <div class="move-top text-right">
        <a href="#home" class="move-top">
            <span class="fa fa-angle-up mb-3" aria-hidden="true"></span>
        </a>
    </div>
    <!-- ==========  //move top ==========  -->



    <!-- ========== lib  ========== -->
    <!-- jquery -->
    <script src="./js/bootstrap.bundle.min.js"></script>
    <script src="./js/jquery-3.6.4.min.js"></script>

    <!-- boostrap -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe"
        crossorigin="anonymous"></script>

    <!-- Full Calendar -->
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.7/index.global.min.js"></script>


    <!-- MDB -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/6.3.1/mdb.min.js"></script>

    <!-- login -->
    <script src="js/Login.js"></script>
    <script src="./js/sweetalert.js"></script>

    <!-- ========== Java Script  ========== -->
    <script>

        let sessionTripId;
        // ====== 網址列取得 tripId & tripOrderId======

        function getTripId() {
            const queryString = window.location.search; // 返回 "?name=John&age=25"
            const urlParams = new URLSearchParams(queryString);
            if (urlParams.get('tripId') != null) {
                return urlParams.get('tripId'); // 返回 "25"
            }
        }
        sessionTripId = getTripId();

        function getMemberId() {

            const testLogIn = JSON.parse(sessionStorage.getItem('test-login'));
            if (!testLogIn || !testLogIn.memberId) {
                return 0;
            }
            return testLogIn.memberId;
        }

        let memberId = getMemberId();

        // ====== get trip infor from DB n display in headers ======
        $.getJSON(`/tripPage/getTrip?tripId=${sessionTripId}`, function (response) {
            $('#tripName').text(`${response.tripName}`);
            $('#city').text(`${response.city}`);
            sessionStorage.setItem('tripName', `${response.tripName}`);
            $('#tripContent').text(`${response.tripContent}`);
            $('#tripDescription').html(`${response.tripDescription}`);
            $('#tripNote').html(`${response.tripNote}`);


            //找到會員id
            // 移動至上方喔
            // let memberId = 0;
            // if (sessionStorage.getItem("test-login")) {
            //     memberId = JSON.parse(sessionStorage.getItem("test-login")).memberId;
            // } else {
            //     memberId = null;
            // }

            //確認資料庫有沒有這筆資料，有了話愛心紅色
            $.ajax({
                url: "/existFavorite",
                method: "POST",
                contentType: "application/json",
                data: JSON.stringify({
                    memberId: memberId,
                    tripId: sessionTripId,
                    favorite: true,
                }),
                success: (response) => {
                    console.log(response);
                    if (response) {
                        $favoriteIcon.addClass("on")
                    } else { $favoriteIcon.removeClass("on") }
                }, error: (error) => {
                    console.log(error);
                }
            });
        });

        // ====== 取得旅遊團資訊 ======
        $.getJSON(`/tripPage/getTourGroup?tripId=${sessionTripId}`)
            .done(function (response) {

                // ====== 沒有tourGroupId的情況 ======
                if (response.length == 0) {
                    // ====== 預設無旅遊團 ======
                    $('#selectedDate').text('目前無旅遊團');

                    $('#confirmedTravelersNo').text(`0 人`);
                    $('#minTravelersNo').text(`0 人`);


                    $('#priceChild').text(`0元 /每人`);
                    $('#priceAdult').text(`0元 /每人`);
                    $('#amount').text('0元');
                    $('#beginPrice').html(`0元 起`);

                    // ====== 日曆點擊後，隨著點擊日期修改內容 ======
                    let calendarEl = document.getElementById('calendar');

                    let calendar = new FullCalendar.Calendar(calendarEl, {
                        selectable: true, // 啟用選擇功能
                    });
                    calendar.render();

                    $('#orderBtn').on('click', function () {
                        Swal.fire('目前沒有旅遊團');

                    });

                } else {
                    // ====== 有tourGroupId的情況 ======
                    // ====== 預設顯示最新的旅遊團 response[0] ======
                    $('#selectedDate').text(`${response[0].formattedStartDate} 至 ${response[0].formattedEndDate}`);
                    sessionStorage.setItem('formattedStartDate', `${response[0].formattedStartDate}`);
                    sessionStorage.setItem('formattedEndDate', `${response[0].formattedEndDate}`);
                    sessionStorage.setItem('tourGroupId', `${response[0].tourGroupId}`);

                    $('#confirmedTravelersNo').text(`${response[0].confirmedTravelersNo} 人`);

                    // ====== 詳細資料描述區塊 ======
                    // ====== minTravelersNo ======
                    $('#minTravelersNo').text(`${response[0].minTravelersNo} 人`);

                    // ===== maxTravelersNo ======
                    let maxTravelersNo = parseInt(response[0].maxTravelersNo);
                    $('#maxTravelersNo').text(`${maxTravelersNo} 人`);

                    // ===== confirmedTravelersNo ======
                    let confirmedTravelersNo = parseInt(response[0].confirmedTravelersNo);

                    // ===== leftTravelersNo ======
                    let leftTravelersNo = (maxTravelersNo - confirmedTravelersNo);
                    $('#leftTravelersNo').text(`${leftTravelersNo} 人`);



                    // ====== priceAdult ======
                    $('#priceAdult').text(`${response[0].priceAdult}/每人`);
                    $('#priceAdult').attr('value', response[0].priceAdult);


                    // ====== priceChild ======
                    $('#priceChild').text(`${response[0].priceChild}/每人`);
                    $('#priceChild').attr('value', response[0].priceChild); // attribute value only workable in this area

                    // ====== number & price area ======
                    // 數量欄
                    let count_child = $("#count_child");
                    let count_adult = $("#count_adult");

                    let currentQtyChild = parseInt(count_child.val());
                    let currentQtyAdult = parseInt(count_adult.val());

                    sessionStorage.setItem('qtyChild', `${currentQtyChild}`);
                    sessionStorage.setItem('qtyAdult', `${currentQtyAdult}`);


                    // 價格
                    let priceChild = parseInt($('#priceChild').attr('value'));
                    let priceAdult = parseInt($('#priceAdult').attr('value'));

                    // 總金額
                    let amount = $('#amount');
                    let amountValue = parseInt($('#amount').val());

                    amountValue = (priceChild * currentQtyChild) + (priceAdult * currentQtyAdult);
                    amount.html(`${amountValue} 元`);

                    // ====== origin price ======
                    $('#beginPrice').html(`${priceChild} 元 起`);



                    // ===== 兒童 =====
                    // 減號按鈕
                    $("#minus_child").on("click", function () {
                        if (currentQtyChild > 0) {
                            currentQtyChild--;
                            sessionStorage.setItem('qtyChild', `${currentQtyChild}`);
                            count_child.val(currentQtyChild);

                            amountValue -= priceChild;
                            amount.html(`${amountValue} 元`);
                        }
                    });
                    // 加號按鈕
                    $("#plus_child").on("click", function () {
                        if ((currentQtyAdult + currentQtyChild) < (leftTravelersNo)) {
                            currentQtyChild++;
                            sessionStorage.setItem('qtyChild', `${currentQtyChild}`);
                            count_child.val(currentQtyChild);

                            amountValue += priceChild;
                            amount.html(`${amountValue} 元`);
                        }

                    });
                    // ===== 大人 =====

                    // 減號按鈕(大人)
                    $("#minus_adult").on("click", function () {
                        if (currentQtyAdult > 0) {
                            currentQtyAdult--;
                            sessionStorage.setItem('qtyAdult', `${currentQtyAdult}`);
                            count_adult.val(currentQtyAdult);

                            // 金額增減
                            amountValue -= priceAdult;
                            amount.html(`${amountValue} 元`);
                        }
                    });

                    // 加號按鈕 (大人)
                    $("#plus_adult").on("click", function () {
                        if ((currentQtyAdult + currentQtyChild) < (leftTravelersNo)) {
                            currentQtyAdult++;
                            sessionStorage.setItem('qtyAdult', `${currentQtyAdult}`);
                            count_adult.val(currentQtyAdult);
                            // 金額增減
                            amountValue += priceAdult;
                            amount.html(`${amountValue} 元`);

                        }
                    });

                    // ====== 兒童輸入數量欄位 ======
                    count_child.on('change', function () {
                        if (parseInt(count_child.val()) >= 0 && (count_child.val() !== null) && (count_child.val() !== '')) {
                            currentQtyChild = parseInt(count_child.val());
                            console.log(`test first ${currentQtyChild}`);
                            console.log(`test first ${(currentQtyAdult + currentQtyChild)}`);
                            if ((currentQtyAdult + currentQtyChild) > (leftTravelersNo)) {
                                Swal.fire('超出剩餘名額，請重新輸入');
                                currentQtyChild = 0;
                                sessionStorage.setItem('qtyChild', `${currentQtyChild}`);
                                count_child.val('0');
                                amountValue = 0;
                                amountValue = (priceAdult * currentQtyAdult);
                                amount.html(`${amountValue} 元`);


                            } else {
                                sessionStorage.setItem('qtyChild', `${currentQtyChild}`);

                                amountValue = 0;
                                amountValue = (priceChild * currentQtyChild) + (priceAdult * currentQtyAdult);
                                amount.html(`${amountValue} 元`);
                            }


                        } else {
                            Swal.fire('輸入錯誤，人數須為正整數');
                            count_child.val('');
                        }

                    });

                    // ====== //兒童輸入數量欄位 ======

                    // ====== 大人輸入數量欄位 ======
                    count_adult.on('change', function () {
                        if (parseInt(count_adult.val()) >= 0 && (count_adult.val() !== null) && (count_adult.val() !== '')) {
                            currentQtyAdult = parseInt(count_adult.val());
                            console.log(`test first ${currentQtyAdult}`);
                            console.log(`test first ${(currentQtyAdult + currentQtyChild)}`);
                            if ((currentQtyAdult + currentQtyChild) > (leftTravelersNo)) {
                                Swal.fire('超出旅遊團人數，請重新輸入');
                                currentQtyAdult = 0;
                                sessionStorage.setItem('qtyAdult', `${currentQtyAdult}`);
                                count_adult.val('0');
                                amountValue = 0;
                                amountValue = (priceChild * currentQtyChild);
                                amount.html(`${amountValue} 元`);

                            } else {
                                sessionStorage.setItem('qtyAdult', `${currentQtyAdult}`);

                                amountValue = 0;
                                amountValue = (priceChild * currentQtyChild) + (priceAdult * currentQtyAdult);
                                amount.html(`${amountValue} 元`);

                            }



                        } else {
                            Swal.fire('輸入錯誤，人數須為正整數');
                            count_adult.val('');

                        }

                    });
                    // ====== //大人輸入數量欄位 ======

                    // ====== 日曆點擊後，隨著點擊日期修改旅遊團內容 ======
                    let calendarEl = document.getElementById('calendar');

                    let calendar = new FullCalendar.Calendar(calendarEl, {
                        selectable: true, // 啟用選擇功能
                        select: function (info) {

                            for (let i = 0; i < response.length; i++) {
                                if (info.startStr === `${response[i].formattedStartDate}`) {
                                    // ====== 預設顯示最新的旅遊團 ======
                                    $('#selectedDate').text(`${response[i].formattedStartDate} 至 ${response[i].formattedEndDate}`);
                                    sessionStorage.setItem('formattedStartDate', `${response[i].formattedStartDate}`);
                                    sessionStorage.setItem('formattedEndDate', `${response[i].formattedEndDate}`);
                                    sessionStorage.setItem('tourGroupId', `${response[i].tourGroupId}`);

                                    $('#confirmedTravelersNo').text(`${response[i].confirmedTravelersNo} 人`);

                                    // ====== minTravelersNo ======
                                    $('#minTravelersNo').text(`${response[i].minTravelersNo} 人`);

                                    // ===== maxTravelersNo ======
                                    let maxTravelersNo = parseInt(response[i].maxTravelersNo);
                                    $('#maxTravelersNo').text(`${maxTravelersNo} 人`);

                                    // ===== confirmedTravelersNo ======
                                    let confirmedTravelersNo = parseInt(response[i].confirmedTravelersNo);

                                    // ===== leftTravelersNo ======
                                    let leftTravelersNo = (maxTravelersNo - confirmedTravelersNo);
                                    $('#leftTravelersNo').text(`${leftTravelersNo} 人`);

                                    // ====== priceAdult ======
                                    $('#priceAdult').text(`${response[i].priceAdult}/每人`);
                                    $('#priceAdult').attr('value', response[i].priceAdult);


                                    // ====== priceChild ======
                                    $('#priceChild').text(`${response[i].priceChild}/每人`);
                                    $('#priceChild').attr('value', response[i].priceChild); // attribute value only workable in this area

                                    // ====== number & price area ======
                                    // 數量欄
                                    let count_child = $("#count_child");
                                    let count_adult = $("#count_adult");

                                    let currentQtyChild = parseInt(count_child.val());
                                    let currentQtyAdult = parseInt(count_adult.val());

                                    sessionStorage.setItem('qtyChild', `${currentQtyChild}`);
                                    sessionStorage.setItem('qtyAdult', `${currentQtyAdult}`);


                                    // 價格
                                    let priceChild = parseInt($('#priceChild').attr('value'));
                                    let priceAdult = parseInt($('#priceAdult').attr('value'));

                                    // 總金額
                                    let amount = $('#amount');
                                    let amountValue = parseInt($('#amount').val());

                                    amountValue = (priceChild * currentQtyChild) + (priceAdult * currentQtyAdult);
                                    amount.html(`${amountValue} 元`);

                                    // ====== origin price ======
                                    $('#beginPrice').html(`${priceChild} 元 起`);


                                    // ===== 兒童 =====
                                    // 減號按鈕
                                    $("#minus_child").on("click", function () {
                                        if (currentQtyChild > 0) {
                                            currentQtyChild--;
                                            sessionStorage.setItem('qtyChild', `${currentQtyChild}`);
                                            count_child.val(currentQtyChild);

                                            amountValue -= priceChild;
                                            amount.html(`${amountValue} 元`);
                                        }
                                    });
                                    // 加號按鈕
                                    $("#plus_child").on("click", function () {
                                        if ((currentQtyAdult + currentQtyChild) < (leftTravelersNo)) {
                                            currentQtyChild++;
                                            sessionStorage.setItem('qtyChild', `${currentQtyChild}`);
                                            count_child.val(currentQtyChild);

                                            amountValue += priceChild;
                                            amount.html(`${amountValue} 元`);
                                        }

                                    });
                                    // ===== 大人 =====

                                    // 減號按鈕(大人)
                                    $("#minus_adult").on("click", function () {
                                        if (currentQtyAdult > 0) {
                                            currentQtyAdult--;
                                            sessionStorage.setItem('qtyAdult', `${currentQtyAdult}`);
                                            count_adult.val(currentQtyAdult);

                                            // 金額增減
                                            amountValue -= priceAdult;
                                            amount.html(`${amountValue} 元`);
                                        }
                                    });

                                    // 加號按鈕 (大人)
                                    $("#plus_adult").on("click", function () {
                                        if ((currentQtyAdult + currentQtyChild) < (leftTravelersNo)) {
                                            currentQtyAdult++;
                                            sessionStorage.setItem('qtyAdult', `${currentQtyAdult}`);
                                            count_adult.val(currentQtyAdult);
                                            // 金額增減
                                            amountValue += priceAdult;
                                            amount.html(`${amountValue} 元`);

                                        }
                                    });

                                    // 兒童輸入數量欄位
                                    count_child.on('change', function () {
                                        if (parseInt(count_child.val()) >= 0 && (count_child.val() !== null) && (count_child.val() !== '')) {
                                            currentQtyChild = parseInt(count_child.val());
                                            console.log(`test first ${currentQtyChild}`);
                                            console.log(`test first ${(currentQtyAdult + currentQtyChild)}`);
                                            if ((currentQtyAdult + currentQtyChild) > (leftTravelersNo)) {
                                                Swal.fire('超出剩餘名額，請重新輸入');
                                                currentQtyChild = 0;
                                                sessionStorage.setItem('qtyChild', `${currentQtyChild}`);
                                                count_child.val('0');
                                                amountValue = 0;
                                                amountValue = (priceAdult * currentQtyAdult);
                                                amount.html(`${amountValue} 元`);


                                            } else {
                                                sessionStorage.setItem('qtyChild', `${currentQtyChild}`);

                                                amountValue = 0;
                                                amountValue = (priceChild * currentQtyChild) + (priceAdult * currentQtyAdult);
                                                amount.html(`${amountValue} 元`);
                                            }


                                        } else {
                                            Swal.fire('輸入錯誤，人數須為正整數');
                                            count_child.val('');
                                        }

                                    });

                                    // 大人輸入數量欄位
                                    count_adult.on('change', function () {
                                        if (parseInt(count_adult.val()) >= 0 && (count_adult.val() !== null) && (count_adult.val() !== '')) {
                                            currentQtyAdult = parseInt(count_adult.val());
                                            console.log(`test first ${currentQtyAdult}`);
                                            console.log(`test first ${(currentQtyAdult + currentQtyChild)}`);
                                            if ((currentQtyAdult + currentQtyChild) > (leftTravelersNo)) {
                                                Swal.fire('超出旅遊團人數，請重新輸入');
                                                currentQtyAdult = 0;
                                                sessionStorage.setItem('qtyAdult', `${currentQtyAdult}`);
                                                count_adult.val('0');
                                                amountValue = 0;
                                                amountValue = (priceChild * currentQtyChild);
                                                amount.html(`${amountValue} 元`);

                                            } else {
                                                sessionStorage.setItem('qtyAdult', `${currentQtyAdult}`);

                                                amountValue = 0;
                                                amountValue = (priceChild * currentQtyChild) + (priceAdult * currentQtyAdult);
                                                amount.html(`${amountValue} 元`);

                                            }



                                        } else {
                                            Swal.fire('輸入錯誤，人數須為正整數');
                                            count_adult.val('');

                                        }

                                    });
                                }
                            }

                        }
                    });
                    calendar.render();

                    // ====== 日曆點擊後，隨著點擊日期修改旅遊團內容 ======

                    // ====== 加入旅遊團 ======
                    for (let i = 0; i < response.length; i++) {
                        let date = response[i].formattedStartDate;
                        let newEvent = {
                            title: '旅遊團',
                            start: `${date}`,
                        }
                        calendar.addEvent(newEvent);
                    }
                    // ====== //加入旅遊團 ======
                    // ====== 我要預定按鈕綁定事件 ======
                    $('#orderBtn').on('click', function () {
                        memberId = getMemberId();
                        if (memberId === 0) {
                            Swal.fire('請登入會員');
                        } else {
                            if (parseInt($('#count_adult').val()) === 0 && parseInt($('#count_child').val()) === 0) {
                                Swal.fire('請至少選取一位人數');
                            } else if ($('#selectedDate').text() === '') {
                                Swal.fire('請選擇旅遊團的日期~');
                            } else {
                                window.location.href = 'group_orderprocess.html';
                            }
                        }

                    });
                    // ====== //我要預定按鈕綁定事件 ======
                }

            }).fail(function (jqXHR, textStatus, errorThrown) {

                // ====== 預設無旅遊團 ======
                $('#selectedDate').text('無旅遊團');

                $('#confirmedTravelersNo').text(`0 人`);
                $('#minTravelersNo').text(`0 人`);


                $('#priceChild').text(`0元 /每人`);
                $('#priceAdult').text(`0元 /每人`);
                $('#amount').text('0元');
                $('#beginPrice').html(`0元 起`);

                // ====== 日曆點擊後，隨著點擊日期修改內容 ======
                let calendarEl = document.getElementById('calendar');

                let calendar = new FullCalendar.Calendar(calendarEl, {
                    selectable: true, // 啟用選擇功能
                });
                calendar.render();

            });


        // ====== 評論區塊 ======

        $.getJSON(`/tripPage/getTripComments?tripId=${sessionTripId}`, function (response) {


            let parentEl = $('#commentParent');

            // ====== 沒有評論的情況 ======
            if (response.length == 0) {

                let childHtml = `<h4 style="color: grey"> 目前沒有評論喔 </h4> <i class="fa-light fa-comment-smile"></i>`;
                parentEl.append(childHtml);

            } else {
                // ====== 有評論的情況 ======
                // ====== 渲染評論頁面 ======
                for (let i = 0; i < response.length; i++) {
                    let base64Url = 'data:image/gif;base64,' + response[i].memberPicBase64;

                    switch (response[i].rating) {
                        case 1:
                            let newChildEl1 = `<li class="list-group-item">
                            <div class="d-flex align-items-start">
                                <div class="flex-shrink-0">
                                    <img src="${base64Url}" alt="memberPics" class="rounded-circle" width="60">
                                </div>
                                <div class="ms-3">
                                    <div class="fw-bold">${response[i].memberName}</div>
                                    <p>${response[i].comment}</p>
                                    <i class="fa-solid fa-star fa-sm" style="color: #f4ec06;"></i>
                                    <div class="text-muted small">${response[i].postTime}</div>
                                </div>
                            </div>
                        </li>`;

                            parentEl.append(newChildEl1);
                            break;
                        case 2:
                            let newChildEl2 = `<li class="list-group-item">
                            <div class="d-flex align-items-start">
                                <div class="flex-shrink-0">
                                    <img src="${base64Url}" alt="memberPics" class="rounded-circle" width="60">
                                </div>
                                <div class="ms-3">
                                    <div class="fw-bold">${response[i].memberName}</div>
                                    <p>${response[i].comment}</p>
                                    <i class="fa-solid fa-star fa-sm" style="color: #f4ec06;"></i>
                                    <i class="fa-solid fa-star fa-sm" style="color: #f4ec06;"></i>
                                    <div class="text-muted small">${response[i].postTime}</div>
                                </div>
                            </div>
                        </li>`;

                            parentEl.append(newChildEl2);
                            break;
                        case 3:
                            let newChildEl3 = `<li class="list-group-item">
                            <div class="d-flex align-items-start">
                                <div class="flex-shrink-0">
                                    <img src="${base64Url}" alt="memberPics" class="rounded-circle" width="60">
                                </div>
                                <div class="ms-3">
                                    <div class="fw-bold">${response[i].memberName}</div>
                                    <p>${response[i].comment}</p>
                                    <i class="fa-solid fa-star fa-sm" style="color: #f4ec06;"></i>
                                    <i class="fa-solid fa-star fa-sm" style="color: #f4ec06;"></i>
                                    <i class="fa-solid fa-star fa-sm" style="color: #f4ec06;"></i>
                                    <div class="text-muted small">${response[i].postTime}</div>
                                </div>
                            </div>
                        </li>`;

                            parentEl.append(newChildEl3);
                            break;
                        case 4:
                            let newChildEl4 = `<li class="list-group-item">
                            <div class="d-flex align-items-start">
                                <div class="flex-shrink-0">
                                    <img src="${base64Url}" alt="memberPics" class="rounded-circle" width="60">
                                </div>
                                <div class="ms-3">
                                    <div class="fw-bold">${response[i].memberName}</div>
                                    <p>${response[i].comment}</p>
                                    <i class="fa-solid fa-star fa-sm" style="color: #f4ec06;"></i>
                                    <i class="fa-solid fa-star fa-sm" style="color: #f4ec06;"></i>
                                    <i class="fa-solid fa-star fa-sm" style="color: #f4ec06;"></i>
                                    <i class="fa-solid fa-star fa-sm" style="color: #f4ec06;"></i>
                                    <div class="text-muted small">${response[i].postTime}</div>
                                </div>
                            </div>
                        </li>`;

                            parentEl.append(newChildEl4);
                            break;
                        case 5:
                            let newChildEl5 = `<li class="list-group-item">
                            <div class="d-flex align-items-start">
                                <div class="flex-shrink-0">
                                    <img src="${base64Url}" alt="memberPics" class="rounded-circle" width="60">
                                </div>
                                <div class="ms-3">
                                    <div class="fw-bold">${response[i].memberName}</div>
                                    <p>${response[i].comment}</p>
                                    <i class="fa-solid fa-star fa-sm" style="color: #f4ec06;"></i>
                                    <i class="fa-solid fa-star fa-sm" style="color: #f4ec06;"></i>
                                    <i class="fa-solid fa-star fa-sm" style="color: #f4ec06;"></i>
                                    <i class="fa-solid fa-star fa-sm" style="color: #f4ec06;"></i>
                                    <i class="fa-solid fa-star fa-sm" style="color: #f4ec06;"></i>
                                    <div class="text-muted small">${response[i].postTime}</div>
                                </div>
                            </div>
                        </li>`;

                            parentEl.append(newChildEl5);
                            break;
                        default:
                            let newChildEl6 = `<li class="list-group-item">
                            <div class="d-flex align-items-start">
                                <div class="flex-shrink-0">
                                    <img src="${base64Url}" alt="memberPics" class="rounded-circle" width="60">
                                </div>
                                <div class="ms-3">
                                    <div class="fw-bold">${response[i].memberName}</div>
                                    <p>${response[i].comment}</p>
                                    <div class="text-muted small">${response[i].postTime}</div>
                                </div>
                            </div>
                        </li>`;

                            parentEl.append(newChildEl6);
                            break;


                    }


                }

                // ====== //渲染評論頁面 ======
            }



        });



        // ====== 綁定選擇方案按鈕 ======

        $('#scrollBtn').on('click', function () {
            let targetOffset = $('#targetSection').offset().top;

            $('html, body').animate({
                scrollTop: targetOffset
            }, 0);
        });

        // ====== //綁定選擇方案按鈕 ======

        // ====== 標頭圖片區 ======
        $.getJSON(`/tripPage/getTripPics?tripId=${sessionTripId}`, function (response) {

            let parentEl = $('#tripPics');
            for (let i = 0; i < response.length; i++) {
                let imageUrl = '/img/trips/' + response[i];
                console.log(imageUrl);
                let newChildEl = `
                <div class="carousel-item active">
                    <img style="weight:80%;  height: 500px;" src="${imageUrl}" class="d-block w-100" alt="tripPics">
                </div>
            `;
                parentEl.append(newChildEl);
            }
        });

        // ====== //標頭圖片區 ======



        // ====== 我的最愛 ======
        //找到會員id
        // 移到最上面喔
        // let memberId = 0;
        // if (sessionStorage.getItem("test-login")) {
        //     memberId = JSON.parse(sessionStorage.getItem("test-login")).memberId;
        // } else {
        //     memberId = null;
        // }

        var $favoriteIcon = $(".my-favorite").find('i');
        //按下收藏
        $(document).ready(function () {

            $("#heart").on("click", function () {
                var requestData = {
                    memberId: memberId,
                    tripId: sessionTripId,
                    favorite: $favoriteIcon.hasClass("on")
                };
                $.ajax({
                    url: "/tripfavorite",
                    type: "POST",
                    contentType: "application/json",
                    data: JSON.stringify(requestData),
                    success: function (response) {
                        switch (response) {
                            case 1:
                                Swal.fire({ icon: 'success', title: '成功加入我的最愛', });
                                $favoriteIcon.addClass("on");
                                break;
                            case 2:
                                Swal.fire({ icon: 'success', title: '已從我的最愛移除', });
                                $favoriteIcon.removeClass("on");
                                break;
                            case 3:
                                Swal.fire({ icon: 'warning', title: '需要登入', });
                                break;
                            default:
                                Swal.fire({ icon: 'error', title: '發生未知的錯誤', });
                                break;
                        }
                    },
                    error: function (error) {
                        console.log(error);
                    }
                });
            });
        });



    </script>

</body>

</html>