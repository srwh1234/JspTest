<!DOCTYPE html>
<html lang="zh-Hant">

<head>
  <title>TripLight | TicketsForm</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta charset="utf-8" />
  <!-- 關鍵字設定 -->
  <meta name="keywords" content="旅遊, 行程規劃, 票券, AI, ChatGPT, Google map, 客製化行程, 套裝行程" />
  <!-- 網頁介紹 -->
  <meta name="description" content="我們提供旅遊行程規劃服務，以及販售套裝行程 票券 等等" />

  <script>
    addEventListener(
      "load",
      function () {
        setTimeout(hideURLbar, 0);
      },
      false
    );

    function hideURLbar() {
      window.scrollTo(0, 1);
    }
  </script>

  <!--jQuery-->
  <link href="https://code.jquery.com/ui/1.10.4/themes/ui-lightness/jquery-ui.css" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-1.10.2.js"></script>
  <script src="https://code.jquery.com/ui/1.10.4/jquery-ui.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
    crossorigin="anonymous"></script>
  <!--會員登入-->
  <link href="css/login.css" rel="stylesheet" />

  <!-- css files -->
  <link href="css/bootstrap.css" rel="stylesheet" type="text/css" />
  <!-- bootstrap css -->
  <link href="css/style.css" rel="stylesheet" type="text/css" />
  <!-- custom css -->
  <link href="css/fontawesome-all.css" rel="stylesheet" />
  <!-- fontawesome css -->
  <!-- //css files -->

  <!-- google fonts -->
  <!-- 載入字體 -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC&display=swap" rel="stylesheet" />
  <!-- //google fonts -->

  <!-- 載入icon -->
  <link rel="shortcut icon" href="./images/icon.png" />
  <link rel="bookmark" href="./images/icon.png" />

  <style>
    /*要設定高度*/
    .my-carousel {
      height: 36rem;
    }

    .container-fluid {
      background-color: #f5f5f5;
    }

    /* 收藏的愛心*/
    .my-favorite .on {
      color: #dc3545;
    }

    .my-favorite .on:hover {
      color: #ccc;
    }

    .my-favorite .off {
      color: #ccc;
    }

    .my-favorite .off:hover {
      color: #dc3545;
    }



    /* 評價的星星 */
    .my-ratings .on {
      color: #26bec9;
    }

    /* 加入購物車的按鈕 */
    #btnAddToCart,
    #btnMinus,
    #btnPlus,
    #btnMore {
      border: #26bec9;
      color: white;
      background-color: #26bec9;
    }

    #btnAddToCart:hover,
    #btnMinus:hover,
    #btnPlus:hover,
    #btnAddToCart:focus,
    #btnMinus:focus,
    #btnPlus:focus {
      border: #26bec9;
      background-color: #09777d;
    }


    /* 文字灰色 */
    .my-text-lightgray {
      color: #ccc;
    }

    .my-text-content {
      margin: 0;
      font-size: 15px;
      line-height: 1.8em;
      letter-spacing: 1px;
      color: #707579;
    }

    /* 票券價格下方的標記 */
    .my-mark {
      margin: 0 6px 6px 0;
      padding: 3px 8px;
      color: #64b3f4;
      background-color: rgba(100, 179, 244, .1);
      display: inline-block;
      line-height: 1;
      text-align: center;
      white-space: nowrap;
      vertical-align: baseline;
      border-radius: 0.25em;
    }



    /* 注意事項 */
    #ticketNote div {
      border-radius: 10px;
      padding: 3rem;
      background: rgba(255, 209, 120, .2);
    }


    .my-comment-bg {
      background-color: #f6f6f6;
      border-radius: 6px;
    }

    .my-hidden {
      visibility: hidden;
    }

    /* 文字水藍 */
    .my-text-lightblue {
      color: #26bec9;
    }

    /* 文字淺紅 */
    .my-text-lightred {
      color: #ef7a70;
    }

    /* 右邊的快速導覽列 */
    #rightNav a {
      padding: 5px 0;
      font-size: 1.2rem;
      letter-spacing: 0.2rem;
      transition: 0.25s;
    }

    #rightNav li :hover {
      color: #26bec9;
      transition: 0.25s;
    }

    #rightNav .active ::before {
      content: "";
      display: inline-block;
      width: 4px;
      height: 24px;
      position: absolute;
      top: 8px;
      left: -16px;
      border-radius: 4px;
      background-color: #26bec9;
    }
  </style>
</head>

<body>
  <!-- header -->
  <header>
    <div class="container" style="padding-right: 0px">
      <!-- nav -->
      <nav class="py-md-4 py-3">
        <div id="logo">
          <h1 class="mt-md-0 mt-2">
            <a href="index.html"><img src="./images/icon.png" class="icon_triplight" />
              TripLight
            </a>
          </h1>
        </div>
        <label for="drop" class="toggle"><span class="fa fa-bars"></span></label>
        <input type="checkbox" id="drop" />
        <ul class="menu ml-auto mt-1">
          <li class=""><a href="index.html">首頁</a></li>
          <li class=""><a href="booking.html">AI行程規劃</a></li>
          <li class="active"><a href="tickets.html">票券</a></li>
          <li class=""><a href="itinerary_search.html?index=1">套裝行程</a></li>
          <li class=""><a href="articles.html">旅遊文章</a></li>
          <li class="booking"><a href="" id="login">登入/註冊</a></li>
          <li class="">
            <a href="shopping_car.html"><img src="./images/shoppingCar.svg" alt="" style="width: 2em" /></a>
          </li>
        </ul>
      </nav>
      <!-- //nav -->
      <div class="member">
        <ul class="member_list">
          <li class="member_li"><a href="login.html"><i class="fa-regular fa-user"></i>管理帳戶</a>
          </li>
          <li class="member_li" id="order_li"><a href=""><i class="fa-solid fa-plane"></i>訂單管理</a>
            <ul class="order_list">
              <li class="order_content"><a href="tickets_order.html"><i class="fa-solid fa-ticket"></i>票券訂單</a></li>
              <li class="order_content"><a href="group_order.html"><i class="fa-solid fa-suitcase"></i>旅遊團訂單</a>
              </li>
            </ul>
          </li>
          <li class="member_li"><a href="my_favorite.html"><i class="fa-regular fa-heart"></i>我的收藏</a></li>
          <li class="member_li"><a href="article_myfavorite.html"><i class="fa-solid fa-copy"></i>我的文章</a></li>
          <li class="member_li"><a href="membership_rating.html"><i class="fa-regular fa-gem"></i>會員分級</a></li>
          <li class="member_li"><a href="question_form.html"><i class="fa-regular fa-comment"></i>提出問題</a></li>
          <li class="member_li"><a href="read_question_list.html"><i class="fa-regular fa-comment"></i>查看問題</a></li>
          <li class="member_li" id="logout_li"><a href=""><i class="fa-solid fa-right-from-bracket"></i>登出</a>
          </li>
        </ul>
      </div>
    </div>
  </header>
  <!-- //header -->
  <!-- 登入 -->

  <div id="login-container">
    <!---container--->

    <div class="main-box login">
      <h3>登入</h3>
      <form action="">
        <div class="input-box">
          <i class="fas fa-envelope icon2"></i> <input type="email" name="email" id="email" required /> <label
            for="">信箱</label>
        </div>
        <div class="input-box">
          <i class="fas fa-lock icon2"></i> <input type="password" name="password" id="password" required />
          <label for="">密碼</label>
        </div>
        <div class="check">
          <label><input type="checkbox" />記住我</label> <a href="#" id="forgetPwd">忘記密碼</a>
        </div>
        <button type="submit" class="main-btn">Login</button>
        <div class="register">
          <p>
            如果沒有帳號?<a href="#" class="register-link">點擊註冊</a>
          </p>
        </div>
      </form>
    </div>

    <div class="main-box register">
      <h3>註冊</h3>
      <form action="">
        <div class="input-box">
          <i class="fas fa-user icon2"></i> <input type="email" name="account" id="register_account" required /> <label
            for="">使用者名稱</label>
        </div>
        <div class="input-box">
          <i class="fas fa-envelope icon2"></i> <input type="email" name="email" id="register_email" required /> <label
            for="">信箱</label>
        </div>
        <div class="input-box">
          <i class="fas fa-lock icon2"></i> <input type="password" name="password" id="register_password" required />
          <label for="">密碼</label>
          <h6 id="pwdHint">密碼設定請超過八碼</h6>
        </div>
        <div class="check">
          <label><input type="checkbox" />我同意所有條款</label>
        </div>
        <button type="submit" class="main-btn">註冊</button>
        <div class="register">
          <p>
            已經有帳號?<a href="#" class="login-link">點擊登入</a>
          </p>
        </div>
      </form>
    </div>

    <span class="close-icon">
      <div class="fas fa-times"></div>
    </span>
  </div>
  <!-- 登入  -->

  <!-- banner -->
  <section class="banner_inner" id="home">
    <div class="banner_inner_overlay"></div>
  </section>
  <!-- //banner -->

  <!-- TODO: 這是正文 -->
  <div class="container my-5">
    <div class="row">
      <div class="col-12">
        <!-- 輪播 (Carousel) -->
        <div id="ticketCarousel" class="carousel slide carousel-fade mb-2" data-bs-ride="carousel">
          <div class="carousel-indicators">
            <!-- 內容給JS填 -->
          </div>
          <div class="carousel-inner my-carousel">
            <!-- 內容給JS填 -->
          </div>
          <button class="carousel-control-prev" type="button" data-bs-target="#ticketCarousel" data-bs-slide="prev">
            <span class="carousel-control-prev-icon"></span>
          </button>
          <button class="carousel-control-next" type="button" data-bs-target="#ticketCarousel" data-bs-slide="next">
            <span class="carousel-control-next-icon"></span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <div class="container-fluid mt-3">
    <div class="container mt-3">
      <!-- 第二排 -->
      <div class="row">

        <!-- 左邊 -->
        <div class="col-12 col-lg-8" id="ticketTitle">
          <!-- 內容給JS填 -->
        </div>

        <!-- 右邊 -->
        <div class="col-12 col-lg-4" id="ticketPrice">
          <!-- 內容給JS填 -->
        </div>
      </div>
    </div>
  </div>


  <div class="container my-5">
    <div class="row">
      <div class="col-12 col-lg-8">

        <div class="my-5" id="ticketContent">
          <!-- 內容給JS填 -->
        </div>

        <hr class="my-5">

        <div class="my-5" id="ticketNote">
          <!-- 內容給JS填 -->
        </div>

        <hr class="my-5">

        <div class="my-5" id="ticketMap">
          <h3>體驗地點</h3>
          <div class="my-3 my-text-content" id="adderss"></div>
          <div class="my-3" id="map" style="width: 100%; height: 500px;"></div>
        </div>


        <hr class="my-5">
        <div class="my-3" id="ticketComment">
          <h3>旅客評論</h3>
          <ul class="list-group my-5">
            <!-- 內容給JS填 -->
          </ul>
        </div>
        <!-- 最下排 -->
        <div class="d-flex justify-content-center align-items-center">
          <button class="btn btn-outline-secondary" type="button" id="btnMore">更多評論</button>
        </div>


      </div>
      <!-- 右邊 -->
      <div class="col-12 col-lg-3 offset-lg-1">
        <div class="m-5 top-0 position-sticky">
          <ul class="" id="rightNav">
            <li class="position-relative"><a class="btn" href="#ticketTitle"> 商品購買</a></li>
            <li class="position-relative"><a class="btn" href="#ticketContent">商品說明</a></li>
            <li class="position-relative"><a class="btn" href="#ticketNote">注意事項 </a></li>
            <li class="position-relative"><a class="btn" href="#ticketMap">體驗地點</a></li>
            <li class="position-relative"><a class="btn" href="#ticketComment">旅客評論</a></li>
          </ul>
        </div>
      </div>
    </div>


  </div>


  <!--  顯示圖片的燈箱 -->
  <div class="modal fade" id="imgModal" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-body text-center">
          <img src="#" class="img-fluid">
        </div>
      </div>
    </div>
  </div>



  <!-- tabs -->
  <section class="choose" id="choose">
    <div class="overlay-all py-5">
      <div class="container py-lg-5 py-sm-4">
        <h2 class="heading text-capitalize text-center mb-lg-5 mb-4"></h2>
        <div class="edu-exp-grids">
          <div class="tab-main">
            <input id="tab1" type="radio" name="tabs" class="www-sm" checked />
            <label for="tab1">我們提供</label>
            <input id="tab2" type="radio" class="www-sm" name="tabs" />
            <label for="tab2">我們保證</label>
            <section id="content1">
              <div class="row text-center">
                <div class="col-lg-4 col-md-6 inner-www-wrap">
                  <div class="inner-sec-grid">
                    <span class="fa fa-gift"></span>
                    <h4 class="mt-md-4 mt-2">精心策劃的行程安排</h4>
                    <p class="mt-3">
                      我們的專業策劃團隊會為您打造一個充滿精彩活動和美食的行程，讓您輕鬆暢遊當地，享受一個難忘的旅程。
                    </p>
                  </div>
                </div>
                <div class="col-lg-4 col-md-6 inner-www-wrap">
                  <div class="inner-sec-grid">
                    <span class="fa fa-gift"></span>
                    <h4 class="mt-md-4 mt-2">舒適的住宿體驗</h4>
                    <p class="mt-3">
                      我們提供各種等級的飯店和民宿選擇，無論您喜歡豪華還是簡約舒適，都可以找到適合您的住宿選擇。
                    </p>
                  </div>
                </div>
                <div class="col-lg-4 col-md-6 inner-www-wrap">
                  <div class="inner-sec-grid">
                    <span class="fa fa-gift"></span>
                    <h4 class="mt-md-4 mt-2">專業的導遊服務</h4>
                    <p class="mt-3">
                      我們的導遊團隊擁有豐富的當地知識和經驗，可以為您提供專業的導遊服務，讓您深入了解當地的文化和歷史。
                    </p>
                  </div>
                </div>
              </div>
            </section>
            <section id="content2">
              <div class="row text-center">
                <div class="col-lg-4 col-md-6 inner-www-wrap">
                  <div class="inner-sec-grid">
                    <span class="fa fa-gift"></span>
                    <h4 class="mt-md-4 mt-2">安全的旅行環境</h4>
                    <p class="mt-3">
                      我們會確保您的旅行環境安全，保護您和您的家人的健康。
                    </p>
                  </div>
                </div>
                <div class="col-lg-4 col-md-6 inner-www-wrap">
                  <div class="inner-sec-grid">
                    <span class="fa fa-gift"></span>
                    <h4 class="mt-md-4 mt-2">優質的服務態度</h4>
                    <p class="mt-3">
                      我們的團隊會以優質的服務態度迎接您的到來，並全程照顧您的需要。
                    </p>
                  </div>
                </div>
                <div class="col-lg-4 inner-www-wrap">
                  <div class="inner-sec-grid">
                    <span class="fa fa-gift"></span>
                    <h4 class="mt-md-4 mt-2">公正透明的價格</h4>
                    <p class="mt-3">
                      我們的套裝行程價格公正透明，沒有隱藏費用，讓您放心出行，無後顧之憂。
                    </p>
                  </div>
                </div>
              </div>
            </section>
          </div>
        </div>
      </div>
    </div>
  </section>
  <!-- tabs -->

  <!-- testimonials -->
  <section class="testimonials py-5" id="testi">
    <div class="container py-lg-5 py-md-3">
      <h3 class="heading text-capitalize text-center mb-lg-5 mb-4">
        我們的客戶評價
      </h3>
      <div class="row pt-xl-4">
        <div class="col-md-4 test-grid px-lg-4">
          <div class="testi-info text-center">
            <p class="text-li">
              "這是一個令人難忘的旅行經驗。整個行程非常安排妥當，旅館和交通工具都很好。導遊非常專業和友好，總是願意回答我們的問題。我們的旅行充滿了歡笑和驚喜。謝謝你們！"
            </p>
            <div class="test-img text-center mt-4">
              <img src="images/te1.jpg" class="img-thumbnail img-fluid" alt="user-image"
                style="max-width: 150px; width: 100%" />
            </div>
            <h3 class="mt-md-4 mt-3">張小姐</h3>
          </div>
        </div>
        <div class="col-md-4 test-grid px-lg-4 my-md-0 my-5">
          <div class="testi-info text-center">
            <p class="text-li">
              "這是我們第一次參加套裝旅遊行程，我們很滿意。導遊非常友好和熱情，每個景點都很精彩。我們住的旅館也很舒適，食物很好吃。整個旅行充滿了歡樂和愉悅。謝謝你們的協助！"
            </p>
            <div class="test-img text-center mt-4">
              <img src="images/te2.jpg" class="img-thumbnail img-fluid" alt="user-image"
                style="max-width: 150px; width: 100%" />
            </div>
            <h3 class="mt-md-4 mt-3">陳先生</h3>
          </div>
        </div>
        <div class="col-md-4 test-grid px-lg-4">
          <div class="testi-info text-center">
            <p class="text-li">
              "這是一個非常出色的套裝旅遊行程。我們參觀了很多著名的景點，都讓我們印象深刻。導遊和司機都很專業和友好。我們的旅行經驗超出了我們的期望。謝謝你們！"
            </p>
            <div class="test-img text-center mt-4">
              <img src="images/te3.jpg" class="img-thumbnail img-fluid" alt="user-image"
                style="max-width: 150px; width: 100%" />
            </div>
            <h3 class="mt-md-4 mt-3">王先生</h3>
          </div>
        </div>
      </div>
    </div>
  </section>
  <!-- //testimonials -->

  <!--footer -->
  <footer>
    <section class="footer footer_w3layouts_section_1its py-5">
      <div class="container py-lg-4 py-3">
        <div class="row footer-top">
          <div class="col-lg-3 col-sm-6 footer-grid_section_1">
            <div class="footer-title">
              <h3>地點資訊</h3>
            </div>
            <div class="row">
              <ul class="col-12 links">
                <li>
                  <a href="https://www.google.com/maps?q=桃園市中壢區復興路46號9樓" target="_blank">地址：桃園市中壢區復興路46號9樓</a>
                </li>
                <li><a href="tel:02-1234-5678">電話：02-1234-5678</a></li>
                <li>
                  <a href="mailto:triplight0411@gmail.com">信箱：triplight0411@gmail.com</a>
                </li>
                <li><a href="tel:02-1234-5678">傳真：02-1234-5678</a></li>
              </ul>
            </div>
          </div>
          <div class="col-lg-3 col-sm-6 footer-grid_section mt-sm-0 mt-4">
            <div class="footer-title">
              <h3>認識TripLight</h3>
            </div>
            <div class="row">
              <ul class="col-10 links">
                <li><a href="about.html" class="scroll">關於我們</a></li>
                <li>
                  <a href="user_terms.html" class="scroll">使用者條款 </a>
                </li>
                <li>
                  <a href="privacy_policy.html" class="scroll">隱私權保護政策</a>
                </li>
                <li><a href="faq.html" class="scroll"> 常見問題與幫助</a></li>
              </ul>
            </div>
          </div>
          <div class="col-lg-3 col-sm-6 mt-lg-0 mt-4 footer-grid_section_1">
            <div class="footer-title">
              <h3>成為合作夥伴</h3>
            </div>
            <div class="row">
              <ul class="col-10 links">
                <li>
                  <a href="supplier_form.html" class="scroll">成為供應商</a>
                </li>
                <li>
                  <a href="blogger_photographer.html" class="scroll">部落客/攝影師合作計畫</a>
                </li>
                <li>
                  <a href="group_form.html" class="scroll">團體客製規劃</a>
                </li>
              </ul>
            </div>
          </div>
          <div class="col-lg-3 col-sm-6 mt-lg-0 mt-4 footer-grid_section_1">
            <div class="footer-title">
              <h3>聯絡我們</h3>
            </div>
            <ul class="social_section_1info">
              <li>
                <a href="https://www.facebook.com/TibaMe"><img src="./images/facebook.svg" alt="facebook" /></a>
              </li>
              <li>
                <a href="https://www.instagram.com/tibame_wiedu/"><img src="./images/instagram.svg"
                    alt="instagram" /></a>
              </li>
              <li>
                <a href="https://twitter.com/"><img src="./images/twitter.svg" alt="twitter" /></a>
              </li>
              <li class="youtube">
                <a href="https://www.youtube.com/channel/UClhecf7eOGHwbKW5e7l_pTA"><img src="./images/youtube.svg"
                    alt="youtube" /></a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </section>
  </footer>
  <!-- //footer -->

  <!-- copyright -->
  <div class="copyright py-3 text-center">
    <p>COPYRIGHT © 2023 TripLight All rights reserved.</p>
  </div>
  <!-- //copyright -->

  <!-- move top -->
  <div class="move-top text-right">
    <a href="#home" class="move-top">
      <span class="fa fa-angle-up mb-3" aria-hidden="true"></span>
    </a>
  </div>
  <!-- move top -->

  <!-- TODO: 這是正文 -->
  <script src="./js/bootstrap.bundle.min.js"></script>
  <script src="./js/jquery-3.6.4.min.js"></script>
  <script src="./js/sweetalert.js"></script>
  <script src="./js/ticket_login_check.js"></script>

  <script>
    //Google Map
    let map;
    let marker;

    //假資料-票券
    let ticket = {
      ticketId: 0,
      ticketType: '票券類型',
      name: '緯育Tibame 後端工程師門票',
      status: 0,
      price: 107000,
      available: 10, //可買數量
      totalSales: 100,
      description: '票券描述<br>第2行<br>第3行<br>第4行<br>第5行',
      content: '票券說明<br>第2行<br>第3行<br>第4行<br>第5行',
      note: '注意事項<br>第2行<br>第3行<br>第4行<br>第5行',
      supplierName: '供應商名稱',
      city: '縣市名',
      address: '',
      latitude: '緯度',
      longitude: '經度',
      rating: 4.5,
      ratingPerson: Math.trunc(Math.random() * 1000),
      favorite: true,
      images: [
        'https://picsum.photos/800/600/?random=1',
        'https://picsum.photos/800/600/?random=2',
      ],
      promotion: {
        price: 97000,
        startDate: '2023/06/21',
        endDate: '2023/07/21'
      }

    };

    //假資料-評論
    let resultComment =
    {
      allPage: 3,
      curPage: 1,
      comments: [
        {
          member: {
            memberNameLast: '會員名稱',
            memberNameFirst: '1號',
            memberPic: '',
          },
          rating: Math.trunc((Math.random() * 5) + 1),
          comment: `評論內容1<br>第2行<br>第3行<br>第4行<br>第5行`,
          postTime: '2023/06/21',
          lastEditTime: '2023/06/21'
        },
      ],
    }



    //TODO: ------------------------------------------//onload

    $(function () {

      let websocket = null;

      //判斷瀏覽器是否支援websocket
      if ('WebSocket' in window) {
        //websocket = new WebSocket(`ws://localhost:8080/TicketDetail`);
        websocket = new WebSocket(`wss://triplight.ddns.net/TicketDetail`);
      }

      websocket.onopen = () => {
        //alert('open');
      }

      //當ws發生錯誤
      websocket.onerror = function () {
        //alert("連線錯誤,請稍後再次嘗試！");
      };

      //接收來自客服的訊息
      websocket.onmessage = function (event) {
        let msg = event.data;

        //console.log(msg);
        if (msg.startsWith('[bk]:')) {
          if (ticket.promotion) {
            return;
          }
          const post = JSON.parse(msg.replace('[bk]:', ''));
          const detail = post.promotionDetails.find(e => e.key.ticketId == ticket.ticketId);
          if (detail) {
            //location.reload();
            ticket.promotion = {
              price: detail.promotionPrice,
              startDate: post.startDate,
              endDate: post.endDate
            };
            render_price();
          }
        } else if (msg.startsWith('[updateCount]:')) {
          const status = msg.replace('[updateCount]:', '');
          ticket.status = parseInt(status);
          render_price();
        }

      }

      //離開網頁時關閉ws
      window.onbeforeunload = function () {
        websocket.close();
        //console.log('close');
      }
      //




      //去後端拿資料
      fetch_data();


      //加入我的最愛的按鈕
      $(document).on('click', '.my-favorite', function () {

        //登入檢查
        const memberId = getMemberId();
        if (!memberId) {
          return;
        }

        const urlParams = new URLSearchParams(window.location.search);
        const id = urlParams.get("id");


        const post = {
          memberId: memberId,
          ticketId: id,
          favorite: $(this).find('i').hasClass('on'),
        };
        fetch(`${getDomainName()}/ticketfavorite`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(post),
        })
          .then(response => response.json())
          .then(data => {

            switch (data) {
              case 1:
                Swal.fire({ icon: 'success', title: '成功加入我的最愛', });
                fetch_data();
                break;
              case 2:
                Swal.fire({ icon: 'success', title: '已從我的最愛移除', });
                fetch_data();
                break;
              case 3:
                Swal.fire({ icon: 'warning', title: '需要登入', });
                break;
              default:
                Swal.fire({ icon: 'error', title: '發生未知的錯誤', });
                break;
            }
          })
          .catch(error => console.log(error));
      });

      //加入購物車的按鈕
      $(document).on('click', '#btnAddToCart', fetch_cart);

      // 減少數量的按鈕點擊事件
      $(document).on('click', '#btnMinus', function () {
        const val = parseInt($('#inputQuantity').val());
        if (val > 1) {
          $('#inputQuantity').val(val - 1);
        }
      });

      // 增加數量的按鈕點擊事件
      $(document).on('click', '#btnPlus', function () {
        const max = parseInt($('#inputQuantity').attr('max'));
        const val = parseInt($('#inputQuantity').val());
        if (val < max) {
          $('#inputQuantity').val(val + 1);
        }
      });

      // 數量輸入框只能放數字
      $(document).on('keydown', '#inputQuantity', function (e) {
        const regx = /\D/;
        if (regx.test(e.key)
          && e.key != 'Enter' && e.key != 'Backspace') {
          e.preventDefault();
        }
      });

      // 數量輸入框空白或不是數字或小於等於0
      $(document).on('change', '#inputQuantity', function () {
        const val = $(this).val().trim();
        if (val === '' || isNaN(val) || parseInt(val) <= 0) {
          $(this).val('1');
          return false;
        }
        const max = parseInt($(this).attr('max'));
        if (parseInt(val) > max) {
          $(this).val(max);
        }
      });

      // 右邊的快速導覽列
      $('#rightNav > li').on('click', function () {
        $('#rightNav > li').removeClass('active');
        $('#rightNav > li').find('a').removeClass('my-text-lightblue');
        $(this).addClass('active');
        $(this).find('a').addClass('my-text-lightblue');
      });

      // 上下捲動時右邊的快速導覽列匹配
      const rightTags = $('#rightNav a[href^="#"]');
      const rem = parseFloat($('html').css('font-size'));
      let currentId = null;

      $(window).on('scroll', function () {
        const currentPos = this.scrollY + (6.25 * rem);
        rightTags.each((i, v) => {
          const targetId = $(v).attr('href');
          const targetElem = $(targetId);

          if (currentPos > targetElem.offset().top
            && currentPos < targetElem.offset().top + targetElem.outerHeight()
            && currentId !== targetId) {
            currentId = targetId;
            $('#rightNav > li').removeClass('active');
            $('#rightNav > li').find('a').removeClass('my-text-lightblue');
            $(`#rightNav a[href^="${currentId}"]`).closest('li').addClass('active');
            $(`#rightNav a[href^="${currentId}"]`).addClass('my-text-lightblue');
          }
        });
      });

      //更多評論
      $(document).on('click', '#btnMore', function () {
        resultComment.curPage++;

        if (resultComment.comments) {
          render_commnet(resultComment.comments);
        }
      });


      // 設定 只要是.lightbox的顯示視窗事件委派
      $(document).on('show.bs.modal', '#imgModal', function (e) {
        const btn = e.relatedTarget;
        const path = $(btn).find('img').attr('src');
        $(this).find('img').attr('src', path);
      });
    });

    //TODO: ------------------------------------------//fetch

    /**
    * 取得票券資料
    */
    function fetch_data() {
      //登入檢查
      let memberId = getMemberId(false);


      const urlParams = new URLSearchParams(window.location.search);
      const id = urlParams.get("id") ?? 0;

      const param = new URLSearchParams();
      param.append('memberId', memberId);
      param.append('ticketId', id);


      fetch(`${getDomainName()}/ticketdetail?${param}`)
        .then(response => response.json())
        .then(data => ticket = data)
        .catch(error => console.log(error))
        .finally(() => {
          render_carousel();
          render_title();
          render_price();

          //地址
          $('#adderss').text(ticket.address);
          //地圖
          const newLatLng = new google.maps.LatLng(ticket.latitude, ticket.longitude);
          marker.setPosition(newLatLng);
          map.panTo(newLatLng);
        });

      fetch_comment(0);
    }

    /**
    * 取得票券評論
    */
    function fetch_comment(curPage) {
      const urlParams = new URLSearchParams(window.location.search);
      const id = urlParams.get("id");
      const post = {
        ticketId: id,
        page: curPage,
        size: 5,
      }

      fetch(`${getDomainName()}/ticketcomments`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(post),
      })
        .then(response => response.json())
        .then(data => resultComment = data)
        .catch(error => console.log(error))
        .finally(() => render_commnet(resultComment.comments));
    }


    /**
    * 加入購物車 
    */
    function fetch_cart() {
      //登入檢查
      const memberId = getMemberId(false);
      // if (!memberId) {
      //   return;
      // }

      const urlParams = new URLSearchParams(window.location.search);
      const id = urlParams.get("id");

      const post = {
        memberId: memberId,
        ticketId: id,
        quantity: parseInt($('#inputQuantity').val()),
      };
      fetch(`${getDomainName()}/addcart`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(post),
      })
        .then(response => response.json())
        .then(data => responseMsg(data))
        .catch(error => responseMsg(0));
    }

    //加入購物車-顯示回應的結果
    function responseMsg(reason) {
      switch (reason) {
        case 0:
          Swal.fire({ icon: 'warning', title: '與伺服器失去聯繫', });
          break;
        case 1:
          //Swal.fire({ icon: 'success', title: '加入購物車成功', });
          sessionStorage.setItem('ShakeCart', '1')
          $('img[src$="shoppingCar.svg"]').addClass('shake-animation');

          Swal.fire({
            icon: 'success', title: '加入購物車成功',
            showCancelButton: true,
            confirmButtonText: '繼續購物',
            cancelButtonText: '查看購物車',
            confirmButtonColor: 'deepPink',// 修改按鈕色碼
            cancelButtonColor: '#26bec9',
          })
            .then(res => {
              if (res.isConfirmed) {
                //繼續購物
                window.location.href = 'tickets.html';
              } else if (res.dismiss === 'cancel') {
                //查看購物車
                sessionStorage.removeItem('ShakeCart');
                window.location.href = 'shopping_car.html';
              }
            })
          break;
        case 2:
          Swal.fire({ icon: 'warning', title: '此商品數量不足', });
          break;
        case 3:
          Swal.fire({ icon: 'warning', title: '此商品已下架', });
          break;
        case 5:
          Swal.fire({ icon: 'info', title: '請登入會員', });
          break;
        default:
          Swal.fire({ icon: 'warning', title: '發生未知的錯誤', });
          break;
      }
      //刷新頁面
      fetch_data();
    }



    //TODO:  ------------------------------------------//render


    /**
    *  渲染票券圖片到輪播中
    */
    function render_carousel() {
      $('#ticketCarousel .carousel-indicators').html('');
      $('#ticketCarousel .carousel-inner').html('');

      ticket.images.forEach((v, i) => {
        $('#ticketCarousel .carousel-indicators').append(`
        <button type="button" data-bs-target="#ticketCarousel"
                data-bs-slide-to="${i}" class="${i == 0 ? 'active' : ''}">
        </button>
        ` );

        $('#ticketCarousel .carousel-inner').append(`
          <div class="carousel-item ${i == 0 ? 'active' : ''}" 
               href="#" data-bs-toggle="modal" data-bs-target="#imgModal">
            <img src="${v}" class="d-block w-100">
          </div>
        `);
      });
    }

    /**
    * 渲染票券描述/內容/額外說明
    */
    function render_title() {
      $('#ticketTitle').html(`
        <div class="d-flex">
          <div class="col-11">
            <div class="h2 my-4">
                  <span>${ticket.name} | ${ticket.ticketType}</span>
            </div>
            <div class="my-3">
              <span class="fa fa-map-marker mx-3"></span>
              <span>台灣- ${ticket.city}</span>
            </div>
            <div class="my-ratings my-text-lightgray">
              <span class="m-3 on">${ticket.rating}</span>
              <i class="fa fa-star ${ticket.rating >= 1 ? 'on' : ''}"></i>
              <i class="fa fa-star ${ticket.rating >= 1 ? 'on' : ''}"></i>
              <i class="fa fa-star ${ticket.rating >= 1 ? 'on' : ''}"></i>
              <i class="fa fa-star ${ticket.rating >= 1 ? 'on' : ''}"></i>
              <i class="fa fa-star ${ticket.rating >= 1 ? 'on' : ''}"></i>
              <span class="m-3">(${ticket.ratingPerson})</span>
            </div>
          </div>
          <div class="col-1">
            <div class="h2 my-text-lightgray my-favorite my-4">
              <i class="fa fa-heart ${ticket.favorite ? 'on' : 'off'}"></i>
            </div>
          </div>
        </div>
        <hr class="my-5">
        <div class="my-5">
          <span class="m-3"><i class="fa fa-undo mx-2"></i>無條件取消</span>
          <span class="m-3"><i class="fa fa-qrcode mx-2"></i>現場請出示 QR code</span>
        </div>
        <hr class="my-5">
        <div class="my-5" id="ticketDesc">
            <p>${ticket.description}</p>
        </div>     
      `);
      $('#ticketContent').html(`
        <h3>商品說明</h3>      
        <div class="my-3 my-text-content"><p>${ticket.content}</p></div>
      `);
      $('#ticketNote').html(`
        <h3>注意事項</h3>
        <div class="my-3 my-text-content"><p>${ticket.note}</p></div>
      `);
    }

    /**
    * 渲染票券價格
    */
    function render_price() {

      //未上架的商品
      let priceHtml_1 = `<button class="btn btn-primary" type="button" id="btnAddToCart">加入購物車</button>`;
      let priceHtml_2 = `<button class="btn btn-danger" type="button">已完售</button>`;
      if (!ticket.status) {
        priceHtml_1 = `<button class="btn btn-primary" type="button">尚未上架</button>`;
        priceHtml_2 = `<button class="btn btn-primary" type="button">尚未上架</button>`;
      }

      $('#ticketPrice').html(`
        <div class="card my-4">
            <div class="card-body p-3"></div>
        </div>
      `);

      const promotion = $('<div class="promotion mb-5">');

      //有促銷
      if (ticket.promotion) {
        promotion.append(`
          <div>
            <span class="h2 fw-bold me-2">${ticket.promotion.price} 元</span>
            <span class="text-decoration-line-through text-muted">${ticket.price} 元</span>
          </div>
          <div class="my-mark">${ticket.promotion.startDate}~${ticket.promotion.endDate}</div>
        `);

      } else {
        promotion.append(`
          <div>
            <span class="h2 fw-bold me-2">${ticket.price} 元</span>
          </div>                
        `);
      }
      $('#ticketPrice .card-body').append(promotion);

      //庫存狀態
      if (ticket.available) {
        $('#ticketPrice .card-body').append(`
            <div class="row my-2 g-2">
              <div class="col-6">
                <div class="input-group input-group">
                  <button class="btn btn-primary" type="button" id="btnMinus">-</button>
                  <input type="text" class="form-control" value="1" max="${ticket.available}" id="inputQuantity">
                  <button class="btn btn-primary" type="button" id="btnPlus">+</button>
                </div>
              </div>
              <div class="col-6">
                ${priceHtml_1}
              </div>
            </div>
        `);
      } else {
        $('#ticketPrice .card-body').append(`
            <div class="row my-2 g-2">
              <div class="col-6">
                <div class="input-group input-group">
                  <button class="btn btn-primary" type="button" id="btnMinus">-</button>
                  <input type="text" class="form-control" value="0" max="${ticket.available}" id="inputQuantity">
                  <button class="btn btn-primary" type="button" id="btnPlus">+</button>
                </div>
              </div>
              <div class="col-6">
                ${priceHtml_2}
              </div>
            </div>
        `);
      }
    }

    /**
    * 會員評論
    */
    function render_commnet(pageComments) {
      for (let comment of pageComments) {
        $('#ticketComment ul').append(`
            <li class="list-group-item1 my-3">
              <div class="row">
                <div class="col-12 col-lg-2 d-flex justify-content-center">
                  <div>
                    <img src="data:image/png;base64,${comment.member.memberPic}" class="rounded-circle" width="70" height="70">
                  </div>
                </div>
                <div class="col-12 col-lg-10">
                  <div class="fw-bold">${comment.member.memberNameLast + comment.member.memberNameFirst}</div>
                  <div class="my-ratings my-text-lightgray mt-2 mb-3">
                    <i class="fa fa-star ${comment.rating >= 1 ? 'on' : ''}"></i>
                    <i class="fa fa-star ${comment.rating >= 2 ? 'on' : ''}"></i>
                    <i class="fa fa-star ${comment.rating >= 3 ? 'on' : ''}"></i>
                    <i class="fa fa-star ${comment.rating >= 4 ? 'on' : ''}"></i>
                    <i class="fa fa-star ${comment.rating >= 5 ? 'on' : ''}"></i>
                    <span class="m-3">${df(comment.postTime)}</span>
                  </div>
                  <div class="my-comment-bg p-3">
                    <div class="my-text-content">${comment.comment}</div>
                    <div class="d-flex">
                      <div class="text-muted small ms-auto">
                        ${comment.lastEditTime ? '編輯時間 ' + df(comment.lastEditTime) : ''}
                      </div>
                    </div>
                  </div>
                  <hr class="my-5">
                </div>
              </div>
            </li>
        `);
      }
      if (resultComment.curPage >= resultComment.allPage) {
        $('#btnMore').remove();
      }
    }

    //TODO:  ------------------------------------------//好用函式

    //日期格式
    function df(dateStr) {
      const date = new Date(dateStr);
      const year = date.getFullYear();
      const month = String(date.getMonth() + 1).padStart(2, '0'); // 使用 padStart 填充月份前面的零
      const day = String(date.getDate()).padStart(2, '0'); // 使用 padStart 填充日期前面的零
      return `${year}/${month}/${day}`;
    }

    //TODO:  ------------------------------------------//API

    // 檢查是否已載入 Google Maps JavaScript API
    if (typeof google === 'undefined' || typeof google.maps === 'undefined') {
      // 若尚未載入，則等待載入完成再使用
      var scriptTag = document.createElement('script');
      scriptTag.src = 'https://maps.googleapis.com/maps/api/js?key=AIzaSyDjB8qWB5NdWyK94by-Vq_GCsgC_B8KiOE&libraries=places&callback=initialize';
      scriptTag.defer = true;
      document.body.appendChild(scriptTag);
    } else {
      // 若已經載入，則直接使用
      initialize();
    }

    //初始化
    function initialize() {

      // 設定地圖中心位置
      let center = new google.maps.LatLng(24.9576355, 121.2250227);

      //這個必須要 如果不想顯示 則需要把div隱藏起來
      map = new google.maps.Map(document.getElementById('map'), {
        center: center,
        zoom: 13
      });

      // 在地圖上加入標記
      marker = new google.maps.Marker({
        position: center,  // 設定標記位置
        map: map,  // 設定標記所在的地圖物件
        title: '所在地'  // 設定標記提示文字
      });
    }



  </script>
</body>
<!-- login顯示 -->
<script src="./js/Login.js"></script>
<!-- login顯示 -->

</html>